<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üì± EPS-TOPIK Builder</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f4f4f4; }
    .card { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); margin-bottom: 1rem; }
    input, textarea { width: 100%; padding: 8px; margin: 4px 0; border-radius: 4px; border: 1px solid #ccc; }
    button { padding: 10px 16px; margin: 4px 2px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-primary { background: #007bff; color: white; }
    .btn-green { background: #28a745; color: white; }
    .btn-gray { background: #6c757d; color: white; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 5px; margin-top: 1rem; }
    .grid button { font-weight: bold; }
  </style>
</head>
<body>  <div class="card">
    <h2>üì± EPS-TOPIK Builder</h2>
    <p><b>üìÑ Upload PDF Soal</b></p>
    <input type="file" id="uploadPdf" accept="application/pdf"/>
  </div>  <div class="card">
    <button class="btn-gray" onclick="prevSoal()">‚¨ÖÔ∏è Kembali</button>
    <button class="btn-primary" onclick="nextSoal()">Berikutnya ‚û°Ô∏è</button><input type="text" id="nomor" placeholder="Nomor Soal" disabled />
<textarea id="pertanyaan" placeholder="Pertanyaan"></textarea>
<input type="text" id="pilihan1" placeholder="Pilihan 1" />
<input type="text" id="pilihan2" placeholder="Pilihan 2" />
<input type="text" id="pilihan3" placeholder="Pilihan 3" />
<input type="text" id="pilihan4" placeholder="Pilihan 4" />
<button class="btn-green" onclick="simpanSoal()">‚ûï Simpan Soal</button>

  </div>  <div class="card">
    <h3>üóÇÔ∏è Daftar Soal</h3>
    <div class="grid" id="gridSoal"></div>
    <button class="btn-primary" onclick="downloadJSON()">‚¨áÔ∏è Ekspor JSON</button>
  </div>  <script>
    let soalList = [];
    let currentIdx = 0;

    document.getElementById('uploadPdf').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();

      reader.onload = async function () {
        const typedarray = new Uint8Array(reader.result);
        const pdf = await pdfjsLib.getDocument({ data: typedarray }).promise;

        let fullText = "";
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          const strings = content.items.map(item => item.str);
          fullText += strings.join(' ') + '\n';
        }

        soalList = parseTextToSoal(fullText);
        currentIdx = 0;
        tampilkanSoal();
        tampilkanGrid();
        alert("‚úÖ Soal berhasil diambil dari PDF: " + soalList.length + " soal");
      };
      reader.readAsArrayBuffer(file);
    });

    function parseTextToSoal(text) {
      const lines = text.split('\n');
      const soal = [];
      let current = null;
      let nomor = 1;
      for (const line of lines) {
        const trimmed = line.trim();
        if (/^\d+\./.test(trimmed)) {
          if (current) soal.push(current);
          current = { nomor: nomor++, pertanyaan: trimmed.replace(/^\d+\.\s*/, ''), opsi: [] };
        } else if (/^[1-4][\)|\.]/.test(trimmed)) {
          current?.opsi.push(trimmed.replace(/^[1-4][\)|\.]\s*/, ''));
        }
      }
      if (current) soal.push(current);
      return soal;
    }

    function tampilkanSoal() {
      const s = soalList[currentIdx];
      if (!s) return;
      document.getElementById("nomor").value = s.nomor || currentIdx + 1;
      document.getElementById("pertanyaan").value = s.pertanyaan || '';
      document.getElementById("pilihan1").value = s.opsi?.[0] || '';
      document.getElementById("pilihan2").value = s.opsi?.[1] || '';
      document.getElementById("pilihan3").value = s.opsi?.[2] || '';
      document.getElementById("pilihan4").value = s.opsi?.[3] || '';
    }

    function simpanSoal() {
      soalList[currentIdx] = {
        nomor: parseInt(document.getElementById("nomor").value),
        pertanyaan: document.getElementById("pertanyaan").value,
        opsi: [
          document.getElementById("pilihan1").value,
          document.getElementById("pilihan2").value,
          document.getElementById("pilihan3").value,
          document.getElementById("pilihan4").value,
        ]
      };
      tampilkanGrid();
    }

    function tampilkanGrid() {
      const container = document.getElementById("gridSoal");
      container.innerHTML = '';
      soalList.forEach((s, i) => {
        const btn = document.createElement('button');
        btn.textContent = s.nomor;
        btn.style.background = i === currentIdx ? '#007bff' : '#ccc';
        btn.onclick = () => { currentIdx = i; tampilkanSoal(); tampilkanGrid(); };
        container.appendChild(btn);
      });
    }

    function nextSoal() {
      simpanSoal();
      if (currentIdx < soalList.length - 1) {
        currentIdx++;
        tampilkanSoal();
        tampilkanGrid();
      }
    }

    function prevSoal() {
      simpanSoal();
      if (currentIdx > 0) {
        currentIdx--;
        tampilkanSoal();
        tampilkanGrid();
      }
    }

    function downloadJSON() {
      const jsonStr = JSON.stringify(soalList, null, 2);
      const blob = new Blob([jsonStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "soal.json";
      a.click();
    }
  </script></body>
</html>      document.getElementById("opsi1").value = s.opsi?.[0] || "";
      document.getElementById("opsi2").value = s.opsi?.[1] || "";
      document.getElementById("opsi3").value = s.opsi?.[2] || "";
      document.getElementById("opsi4").value = s.opsi?.[3] || "";
    }

    document.getElementById("pdfInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file.type !== "application/pdf") return;

      const pdfPreview = document.getElementById("pdfPreview");
      pdfPreview.innerHTML = "Loading PDF...";

      const reader = new FileReader();
      reader.onload = function () {
        const typedarray = new Uint8Array(reader.result);
        pdfjsLib.getDocument(typedarray).promise.then(function (pdf) {
          pdfPreview.innerHTML = "";
          for (let i = 1; i <= pdf.numPages; i++) {
            pdf.getPage(i).then(function (page) {
              const viewport = page.getViewport({ scale: 1.2 });
              const canvas = document.createElement("canvas");
              const context = canvas.getContext("2d");
              canvas.height = viewport.height;
              canvas.width = viewport.width;
              pdfPreview.appendChild(canvas);
              page.render({ canvasContext: context, viewport: viewport });
            });
          }
        });
      };
      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
